# GoldSky_Lite v0.5.1 Bugä¿®å¤

ä¿®å¤æ—¥æœŸ: 2025-11-08

---

## ğŸ› ä¿®å¤çš„é—®é¢˜

### 1. é¦–é¡µæ»šåŠ¨å¹¿å‘Šä¸åŠ¨ â­â­â­

**é—®é¢˜**:
- ç”¨æˆ·åé¦ˆé¦–é¡µå¹¿å‘Šæ–‡å­—æ²¡æœ‰æ»šåŠ¨
- æ–‡å­—é™æ­¢ä¸åŠ¨

**åŸå› åˆ†æ**:
```cpp
void handleWelcomeState() {
    // åªåœ¨é¦–æ¬¡è¿›å…¥æ—¶åˆ·æ–°æ˜¾ç¤º
    static bool displayRefreshed = false;
    if (!displayRefreshed) {
        displayWelcome();  // âŒ åªè°ƒç”¨ä¸€æ¬¡
        displayRefreshed = true;
    }
}
```

æ»šåŠ¨åŠ¨ç”»éœ€è¦æŒç»­åˆ·æ–°å±å¹•æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œä½† `displayWelcome()` åªè°ƒç”¨ä¸€æ¬¡ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:
```cpp
void handleWelcomeState() {
    // æŒç»­åˆ·æ–°æ˜¾ç¤ºä»¥æ”¯æŒæ»šåŠ¨åŠ¨ç”»
    displayWelcome();  // âœ… æ¯å¸§éƒ½è°ƒç”¨
}
```

**ä¿®æ”¹æ–‡ä»¶**: GoldSky_Lite.ino:549-569

---

### 2. é½¿è½®åŠ¨ç”»å¤ªå°ä¸”æœ‰å€’è®¡æ—¶å¹²æ‰° â­â­

**é—®é¢˜**:
- ç”¨æˆ·è¦æ±‚å»æ‰å€’è®¡æ—¶
- æ”¾å¤§é½¿è½®åŠ¨ç”»æ•ˆæœ

**ä¿®å¤æ–¹æ¡ˆ**:

#### åˆ é™¤å€’è®¡æ—¶
```cpp
// æ—§ç‰ˆ - æœ‰å€’è®¡æ—¶
display.setFont(u8g2_font_logisoso16_tn);
char timeBuffer[10];
sprintf(timeBuffer, "%02d:%02d", remainingMin, remainingSec);
display.drawStr(getCenterX(timeBuffer), titleY + 22, timeBuffer);

// æ–°ç‰ˆ - æ— å€’è®¡æ—¶
// (å·²åˆ é™¤)
```

#### æ”¾å¤§é½¿è½®
| å‚æ•° | æ—§ç‰ˆ | æ–°ç‰ˆ | å˜åŒ– |
|------|------|------|------|
| é½¿è½®åŠå¾„ | 8åƒç´  | 16åƒç´  | **+100%** |
| é½¿è½®ä½ç½® | åº•éƒ¨å³ä¾§ | å±å¹•ä¸­å¿ƒå³ä¾§ | æ›´æ˜¾çœ¼ |
| é½¿è½®çº¿æ¡ | å•çº¿ | åŒçº¿åŠ ç²— | æ›´æ¸…æ™° |
| æ—‹è½¬é€Ÿåº¦ | 200ms | 150ms | **+25%** |
| æ•°å­—å¤§å° | å°å­—ä½“ | å¤§å­—ä½“ | æ›´é†’ç›® |
| ä¿¡å·çº¿æ¡ | å•çº¿ | åŒçº¿åŠ ç²— | æ›´æ¸…æ™° |
| ç®­å¤´ | ç»†ç®­å¤´ | ç²—ç®­å¤´ | æ›´æ˜æ˜¾ |

#### æ–°å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Wash in Progress         â”‚ â† æ ‡é¢˜
â”‚                             â”‚
â”‚  1 0 1 0  â•â•â•â–º  âš™âš™         â”‚ â† æ”¾å¤§çš„é½¿è½®åŠ¨ç”»
â”‚                             â”‚
â”‚          1/5                â”‚ â† è„‰å†²è®¡æ•°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ”¹è¿›**:
- âœ… é½¿è½®åŠå¾„ä»8â†’16åƒç´ 
- âœ… é½¿è½®ä¸‰å±‚åœ†åœˆï¼ˆæ›´ç«‹ä½“ï¼‰
- âœ… é½¿è½®ä¸­å¿ƒå®å¿ƒç‚¹
- âœ… é½¿è½®é½¿åŠ ç²—ï¼ˆåŒçº¿ï¼‰
- âœ… æ•°å­—ä¿¡å·ç”¨å¤§å­—ä½“
- âœ… ä¿¡å·è¿æ¥çº¿åŠ ç²—
- âœ… ç®­å¤´åŠ ç²—
- âœ… ä½ç½®å±…ä¸­æ›´æ˜¾çœ¼

**ä¿®æ”¹æ–‡ä»¶**: GoldSky_Display.ino:394-482

---

### 3. å®Œæˆé¡µæ˜¾ç¤ºBug (å·²åœ¨v0.5ä¿®å¤)

**é—®é¢˜**:
- 4æ¬¡æµ‹è¯•ä¸­åªæœ‰ç¬¬1æ¬¡æ˜¾ç¤ºThank Youé¡µé¢

**æ ¹æœ¬åŸå› **:
```cpp
// é”™è¯¯çš„åˆå§‹åŒ–
static SystemState lastState = STATE_COMPLETE;  // âŒ

// ç¬¬ä¸€æ¬¡è¿›å…¥STATE_COMPLETEæ—¶
if (currentState != lastState) {  // âŒ false (å› ä¸ºéƒ½æ˜¯STATE_COMPLETE)
    displayRefreshed = false;     // æ°¸è¿œä¸æ‰§è¡Œ
}
```

**ä¿®å¤** (v0.5å·²ä¿®å¤):
```cpp
// æ­£ç¡®çš„åˆå§‹åŒ–
static SystemState lastState = STATE_WELCOME;  // âœ…

// å…ˆæ£€æŸ¥çŠ¶æ€å˜åŒ–
if (currentState != lastState) {
    displayRefreshed = false;
    soundPlayed = false;
    lastState = STATE_COMPLETE;
}

// å†åˆ·æ–°æ˜¾ç¤º
if (!displayRefreshed) {
    displayComplete();
    displayRefreshed = true;
}
```

**ä¿®æ”¹æ–‡ä»¶**: GoldSky_Lite.ino:834-867

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### é¦–é¡µæ»šåŠ¨å¹¿å‘Š

| æ–¹é¢ | v0.5 | v0.5.1 |
|------|------|--------|
| è°ƒç”¨æ¬¡æ•° | 1æ¬¡ | æŒç»­è°ƒç”¨ |
| æ»šåŠ¨æ•ˆæœ | âŒ æ—  | âœ… æœ‰ |
| åŠ¨ç”»æµç•…åº¦ | N/A | 60ms/åƒç´  |

### é½¿è½®åŠ¨ç”»

| æ–¹é¢ | v0.5 | v0.5.1 | æå‡ |
|------|------|--------|------|
| é½¿è½®åŠå¾„ | 8px | 16px | +100% |
| å€’è®¡æ—¶ | æœ‰ | æ—  | ç®€åŒ– |
| ä½ç½® | åº•éƒ¨ | ä¸­å¿ƒ | æ›´æ˜¾çœ¼ |
| çº¿æ¡ | å•çº¿ | åŒçº¿ | æ›´æ¸…æ™° |
| æ—‹è½¬é€Ÿåº¦ | 200ms | 150ms | +25% |
| è§†è§‰å†²å‡»åŠ› | â­â­ | â­â­â­â­ | +100% |

### å®Œæˆé¡µæ˜¾ç¤º

| æ–¹é¢ | v2.4 | v0.5 | v0.5.1 |
|------|------|------|--------|
| å¯é æ€§ | 25% | 100% | 100% |
| çŠ¶æ€ | Bug | å·²ä¿®å¤ | ç¨³å®š |

---

## ğŸ¨ æ–°é½¿è½®åŠ¨ç”»è¯¦ç»†å‚æ•°

### é½¿è½®ç»˜åˆ¶
```cpp
int gearRadius = 16;  // åŠå¾„16åƒç´ 

// ä¸‰å±‚åœ†åœˆï¼ˆç«‹ä½“æ„Ÿï¼‰
display.drawCircle(gearX, gearY, gearRadius);      // å¤–åœˆ
display.drawCircle(gearX, gearY, gearRadius - 1);  // ä¸­åœˆ
display.drawCircle(gearX, gearY, gearRadius - 4);  // å†…åœˆ

// 8ä¸ªé½¿ï¼ˆåŠ ç²—ï¼‰
for (int i = 0; i < 8; i++) {
    display.drawLine(x1, y1, x2, y2);
    display.drawLine(x1 + 1, y1, x2 + 1, y2);  // åŠ ç²—
}

// ä¸­å¿ƒå®å¿ƒç‚¹
display.drawDisc(gearX, gearY, 3);
```

### æ•°å­—ä¿¡å·
```cpp
display.setFont(u8g2_font_helvB08_tf);  // å¤§å­—ä½“

// ä¿¡å·é—´è·25åƒç´ ï¼ˆæ›´å®½æ¾ï¼‰
for (int i = 0; i < 4; i++) {
    int digitX = area.x + 5 + pulsePos + (i * 25);
}

// è¿æ¥çº¿åŠ ç²—
display.drawLine(digitX - 8, centerY, digitX - 2, centerY);
display.drawLine(digitX - 8, centerY + 1, digitX - 2, centerY + 1);
```

### ç®­å¤´
```cpp
// åŠ ç²—ç®­å¤´
display.drawLine(arrowX, centerY, arrowX + 15, centerY);
display.drawLine(arrowX, centerY + 1, arrowX + 15, centerY + 1);
display.drawLine(arrowX + 15, centerY, arrowX + 10, centerY - 3);
display.drawLine(arrowX + 15, centerY, arrowX + 10, centerY + 3);
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### é¦–é¡µæ»šåŠ¨æµ‹è¯•
1. ä¸Šç”µå¯åŠ¨
2. è§‚å¯Ÿæ¬¢è¿é¡µ
3. ç¡®è®¤æ–‡å­—ä»å³å‘å·¦æŒç»­æ»šåŠ¨
4. æ— ç¼å¾ªç¯ï¼Œæ²¡æœ‰åœé¡¿

### é½¿è½®åŠ¨ç”»æµ‹è¯•
1. è¿›å…¥æ´—è½¦æµç¨‹
2. è§‚å¯Ÿé½¿è½®åŠ¨ç”»
3. ç¡®è®¤ï¼š
   - é½¿è½®ä½äºå±å¹•ä¸­å¿ƒ
   - é½¿è½®æ¸…æ™°å¯è§ï¼ˆ16åƒç´ ï¼‰
   - æ—‹è½¬æµç•…ï¼ˆ150ms/å¸§ï¼‰
   - æ•°å­—ä¿¡å·æµåŠ¨
   - ç®­å¤´æŒ‡å‘é½¿è½®
   - è„‰å†²è®¡æ•°æ˜¾ç¤ºåœ¨åº•éƒ¨

### å®Œæˆé¡µæµ‹è¯•
1. å®Œæˆä¸€æ¬¡æ´—è½¦
2. è§‚å¯Ÿå®Œæˆé¡µï¼ˆåº”è¯¥æ˜¾ç¤ºï¼‰
3. å†å®Œæˆä¸€æ¬¡æ´—è½¦
4. å†æ¬¡è§‚å¯Ÿå®Œæˆé¡µï¼ˆåº”è¯¥æ˜¾ç¤ºï¼‰
5. é‡å¤æµ‹è¯•4-5æ¬¡
6. æ¯æ¬¡éƒ½åº”è¯¥æ­£å¸¸æ˜¾ç¤º

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### åŠ¨ç”»åˆ·æ–°æœºåˆ¶
```cpp
// é”™è¯¯æ–¹å¼ - åªè°ƒç”¨ä¸€æ¬¡
static bool displayed = false;
if (!displayed) {
    displayAnimation();  // âŒ åŠ¨ç”»ä¸ä¼šæ›´æ–°
    displayed = true;
}

// æ­£ç¡®æ–¹å¼ - æŒç»­è°ƒç”¨
displayAnimation();  // âœ… æ¯å¸§éƒ½è°ƒç”¨
```

### çŠ¶æ€ç®¡ç†
```cpp
// å…³é”®ï¼šlastStateåˆå§‹åŒ–ä¸èƒ½æ˜¯ç›®æ ‡çŠ¶æ€
static SystemState lastState = STATE_WELCOME;  // âœ… æ­£ç¡®

// é”™è¯¯ç¤ºä¾‹
static SystemState lastState = STATE_COMPLETE;  // âŒ é”™è¯¯
```

---

## ğŸ“ ä»£ç å˜æ›´

### ä¿®æ”¹çš„æ–‡ä»¶
1. **GoldSky_Lite.ino**
   - handleWelcomeState() - æŒç»­è°ƒç”¨displayWelcome()

2. **GoldSky_Display.ino**
   - displayWashProgress() - å®Œå…¨é‡æ„ï¼Œæ”¾å¤§é½¿è½®åŠ¨ç”»

### æ–°å¢æ–‡ä»¶
- BUGFIX_V0.5.1.md (æœ¬æ–‡æ¡£)

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³æµ‹è¯•
- [ ] é¦–é¡µæ»šåŠ¨å¹¿å‘Š
- [ ] é½¿è½®åŠ¨ç”»æ•ˆæœ
- [ ] å®Œæˆé¡µå¤šæ¬¡æ˜¾ç¤º

### å¦‚æœæµ‹è¯•é€šè¿‡
- [ ] æäº¤ä»£ç åˆ°Git
- [ ] æ›´æ–°ç‰ˆæœ¬å·åˆ°v0.5.1
- [ ] æ¨é€åˆ°GitHub

### å¦‚æœå‘ç°é—®é¢˜
- [ ] è®°å½•é—®é¢˜ç°è±¡
- [ ] åˆ†ææ ¹æœ¬åŸå› 
- [ ] ç»§ç»­ä¿®å¤

---

**ä¿®å¤ç‰ˆæœ¬**: v0.5.1
**ä¿®å¤æ–‡ä»¶æ•°**: 2
**ä¿®å¤é—®é¢˜æ•°**: 3
**çŠ¶æ€**: âœ… å¾…æµ‹è¯•
